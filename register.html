<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Register</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      :root{--bg:#0f111a;--panel:#161a26;--text:#e8eaf1;--muted:#aab0c0;--accent:#6d5efc;--border:#2a3146;}
      *{box-sizing:border-box}
      body{margin:0;font-family:system-ui,Segoe UI,Arial;background:var(--bg);color:var(--text);min-height:100vh;display:grid;place-items:center;padding:24px}
      .card{width:min(560px,100%);background:var(--panel);border:1px solid var(--border);border-radius:18px;padding:18px}
      h1{margin:8px 0 4px}
      p{margin:0 0 14px;color:var(--muted)}
      label{display:block;font-size:13px;color:var(--muted);margin:10px 0 6px}
      input{width:100%;padding:12px;border-radius:12px;border:1px solid var(--border);background:#0f1320;color:var(--text)}
      .row{display:flex;gap:10px;margin-top:14px}
      button{flex:1;padding:12px;border-radius:12px;border:1px solid var(--border);background:#1b2030;color:var(--text);cursor:pointer;font-weight:700}
      .primary{border:none;background:linear-gradient(135deg,#6d5efc,#8b7dff)}
      a{color:#b8b1ff}
      .tiny{font-size:12px;color:var(--muted);margin-top:10px}
      .err{margin-top:10px;color:#ffb4b4;font-size:13px;display:none}
    </style>
  </head>
  <body>
    <div class="card">
      <h1>Register</h1>
      <p>Create your account.</p>

      <label>Username</label>
      <input id="user" placeholder="e.g. alex" autocomplete="username" />

      <label>Email</label>
      <input id="email" placeholder="e.g. alex@gmail.com" autocomplete="email" />

      <label>Password</label>
      <input id="pass" type="password" placeholder="**********" autocomplete="new-password" />

      <div class="row">
        <button onclick="location.href='index.html'">Back</button>
        <button class="primary" id="regBtn" onclick="register()">Register</button>
      </div>

      <div class="err" id="errBox"></div>
      <div class="tiny">Already have an account? <a href="login.html">Login</a></div>
    </div>

    <script>
      // If frontend is served by FastAPI, keep empty:
      const API_BASE = "https://150.230.127.214:2022";
      

      const errBox = document.getElementById("errBox");
      const regBtn = document.getElementById("regBtn");

      document.getElementById("pass").addEventListener("keydown", (e) => {
        if (e.key === "Enter") register();
      });

      function showError(msg){
        errBox.textContent = msg;
        errBox.style.display = "block";
      }
      function clearError(){
        errBox.textContent = "";
        errBox.style.display = "none";
      }

      async function register(){
        clearError();

        const username = document.getElementById("user").value.trim();
        const email = document.getElementById("email").value.trim();
        const password = document.getElementById("pass").value;

        if(!username) return showError("Please enter a username.");
        if(!email) return showError("Please enter an email.");
        if(!password) return showError("Please enter a password.");

        regBtn.disabled = true;
        regBtn.textContent = "Creating...";

        try{
          const res = await fetch(`${API_BASE}/auth/register`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ username, email, password })
          });

          if(!res.ok){
            let msg = "Registration failed.";
            try{
              const data = await res.json();
              msg = data.detail || msg;
            }catch{
              msg = await res.text();
            }
            throw new Error(msg);
          }

          const data = await res.json();
          if(!data.access_token) throw new Error("No access_token returned from server.");

          localStorage.setItem("token", data.access_token);
          localStorage.setItem("demo_user", username);

          location.href = "app.html";
        }catch(e){
          console.error(e);
          showError(e.message || "Register error.");
        }finally{
          regBtn.disabled = false;
          regBtn.textContent = "Register";
        }
      }
    </script>
  </body>
</html>

